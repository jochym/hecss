---

title: Monitor

keywords: fastai
sidebar: home_sidebar

summary: "Monitoring functions for HECSS sampler"
description: "Monitoring functions for HECSS sampler"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_monitor.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">un</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">loadtxt</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="n">median</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">plot</span><span class="p">,</span> <span class="n">figure</span><span class="p">,</span> <span class="n">subplot</span><span class="p">,</span> <span class="n">legend</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="n">sca</span><span class="p">,</span> <span class="n">semilogx</span><span class="p">,</span> <span class="n">semilogy</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xticks</span><span class="p">,</span> <span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="p">,</span> <span class="n">axhline</span><span class="p">,</span> <span class="n">axvline</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">sys</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">plot_band_set</span><span class="p">(</span><span class="n">bnd</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">THz</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lbl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lbl</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">kwa</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,)}</span>
    <span class="n">plt</span><span class="o">=</span><span class="n">plot</span><span class="p">(</span><span class="n">bnd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">un</span><span class="o">.</span><span class="n">invcm</span> <span class="o">*</span> <span class="n">bnd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">units</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bnd</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
        <span class="n">plot</span><span class="p">(</span><span class="n">bnd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">un</span><span class="o">.</span><span class="n">invcm</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="n">units</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwa</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_bands" class="doc_header"><code>plot_bands</code><a href="https://gitlab.com/jochym/hecss/tree/nbdev/hecss/monitor.py#L11" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_bands</code>(<strong><code>bnd</code></strong>, <strong><code>kpnts</code></strong>, <strong><code>units</code></strong>=<em><code>0.0041356676623401645</code></em>, <strong><code>decorate</code></strong>=<em><code>True</code></em>, <strong><code>lbl</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_bands_file" class="doc_header"><code>plot_bands_file</code><a href="https://gitlab.com/jochym/hecss/tree/nbdev/hecss/monitor.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_bands_file</code>(<strong><code>fn</code></strong>, <strong><code>units</code></strong>=<em><code>0.0041356676623401645</code></em>, <strong><code>decorate</code></strong>=<em><code>True</code></em>, <strong><code>lbl</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">run_alamode</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s1">&#39;phon&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;cryst&#39;</span><span class="p">,</span> <span class="n">kpath</span><span class="o">=</span><span class="s1">&#39;cryst&#39;</span><span class="p">,</span> <span class="n">dfset</span><span class="o">=</span><span class="s1">&#39;DFSET&#39;</span><span class="p">,</span> <span class="n">sc</span><span class="o">=</span><span class="s1">&#39;../sc/CONTCAR&#39;</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c2</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">born</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">fit_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/home/jochym/Projects/alamode-tools/devel/make-gen.py opt -p </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1"> -n </span><span class="si">{</span><span class="n">sc</span><span class="si">}</span><span class="s1"> -f </span><span class="si">{</span><span class="n">dfset</span><span class="si">}</span><span class="s1"> -o </span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s1"> --c2 </span><span class="si">{</span><span class="n">c2</span><span class="si">}</span><span class="s1"> -d </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="n">prefix</span>
    <span class="k">if</span> <span class="n">born</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;-b </span><span class="si">{</span><span class="n">born</span><span class="si">}</span><span class="s1"> -c </span><span class="si">{</span><span class="n">charge</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">phon_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/home/jochym/Projects/alamode-tools/devel/make-gen.py phon -p </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1"> -n ../sc/CONTCAR </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1"> -k </span><span class="si">{</span><span class="n">kpath</span><span class="si">}</span><span class="s1">.path&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">alm_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/home/jochym/public/bin/alm </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_fit.in&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">anph_cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/home/jochym/public/bin/anphon </span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_phon.in&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_fit.in&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fit</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fit_cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">ff</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_phon.in&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">phon</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">phon_cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">ff</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

    <span class="n">alm</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">alm_cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">anph</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">anph_cmd</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="n">fit</span><span class="p">,</span> <span class="n">phon</span><span class="p">,</span> <span class="n">alm</span><span class="p">,</span> <span class="n">anph</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="s1">&#39;phon&#39;</span><span class="p">,</span> <span class="s1">&#39;alm&#39;</span><span class="p">,</span> <span class="s1">&#39;anphon&#39;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">stdout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s1">.log&#39;</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lf</span><span class="p">:</span>
                <span class="n">lf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">stderr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s1">.err&#39;</span><span class="p">,</span> <span class="s1">&#39;wt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lf</span><span class="p">:</span>
                <span class="n">lf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

    <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">returncode</span><span class="o">==</span><span class="mi">0</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span>  <span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">phon</span><span class="p">,</span> <span class="n">alm</span><span class="p">,</span> <span class="n">anph</span><span class="p">)]),</span> <span class="n">fit</span><span class="p">,</span> <span class="n">phon</span><span class="p">,</span> <span class="n">alm</span><span class="p">,</span> <span class="n">anph</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_dfset_len</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="s1">&#39;phon/DFSET&#39;</span><span class="p">):</span>
    <span class="k">try</span> <span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">as</span> <span class="n">dfset</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">dfset</span> <span class="k">if</span> <span class="s1">&#39;set:&#39;</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">show_dc_conv</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">kpnts</span><span class="p">,</span> <span class="n">max_plots</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">prev_n</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bl</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">plot_bands</span><span class="p">(</span><span class="n">bl</span><span class="p">[</span><span class="n">prev_n</span><span class="p">],</span> <span class="n">kpnts</span><span class="p">,</span> <span class="n">lbl</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prev_n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">)</span>
    <span class="n">y_lims</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">()</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">plotted</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">bl</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">prev_n</span><span class="o">*</span><span class="mf">0.75</span> <span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">alpha</span> <span class="o">*=</span> <span class="mf">0.8</span>
        <span class="n">plot_band_set</span><span class="p">(</span><span class="n">bl</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">lbl</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plotted</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">prev_n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">if</span> <span class="n">plotted</span> <span class="o">&gt;</span> <span class="n">max_plots</span> <span class="p">:</span>
            <span class="k">break</span>
    <span class="n">ylim</span><span class="p">(</span><span class="n">y_lims</span><span class="p">)</span>
    <span class="n">legend</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_bnd_lst</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;phon&#39;</span><span class="p">,</span> <span class="n">dfset</span><span class="o">=</span><span class="s1">&#39;DFSET&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;cryst&#39;</span><span class="p">,</span> <span class="n">kpath</span><span class="o">=</span><span class="s1">&#39;crast&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">born</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">get_dfset_len</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">dfset</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">bl</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Using first </span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s1">3</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">run_alamode</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">dfset</span><span class="o">=</span><span class="n">dfset</span><span class="p">,</span> <span class="n">kpath</span><span class="o">=</span><span class="n">kpath</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">c2</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">born</span><span class="o">=</span><span class="n">born</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">charge</span><span class="p">)</span>
        <span class="n">bl</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">loadtxt</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">.bands&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> 
    <span class="k">if</span> <span class="n">verbose</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">bl</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">build_omega</span><span class="p">(</span><span class="n">bl</span><span class="p">,</span> <span class="n">kpnts</span><span class="p">):</span>
    <span class="n">omega</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">eps</span><span class="o">=</span><span class="mf">1e-3</span>
    <span class="n">kp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">kpnts</span><span class="p">)}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">omega</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">([[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">bnd</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="nb">abs</span><span class="p">(</span><span class="n">bnd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">v</span><span class="p">)</span><span class="o">&lt;</span><span class="n">eps</span><span class="p">][:,</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">bnd</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bl</span><span class="o">.</span><span class="n">items</span><span class="p">())])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">omega</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">omega</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span><span class="o">-</span><span class="mi">1</span><span class="p">][:,</span><span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">omega</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">omega</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">plot_omega</span><span class="p">(</span><span class="n">omega</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">omega</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">2</span> <span class="p">:</span>
            <span class="k">return</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">k</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">Gamma$&#39;</span>
        <span class="n">semilogy</span><span class="p">(</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">un</span><span class="o">.</span><span class="n">invcm</span> <span class="o">*</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="n">THz</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
    
    <span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="n">functions</span><span class="o">=</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">un</span><span class="o">.</span><span class="n">invcm</span><span class="o">*</span><span class="n">median</span><span class="p">([</span><span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">omega</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">/</span><span class="n">THz</span>
    <span class="k">if</span> <span class="n">rng</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
        <span class="n">ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span>
    <span class="c1">#axhline(0, ls=&#39;:&#39;, lw=1)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency convergence (THz)&#39;</span><span class="p">)</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of samples&#39;</span><span class="p">)</span>    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="monitor_phonons" class="doc_header"><code>monitor_phonons</code><a href="https://gitlab.com/jochym/hecss/tree/nbdev/hecss/monitor.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>monitor_phonons</code>(<strong><code>directory</code></strong>=<em><code>'phon'</code></em>, <strong><code>dfset</code></strong>=<em><code>'DFSET'</code></em>, <strong><code>prefix</code></strong>=<em><code>'cryst'</code></em>, <strong><code>kpath</code></strong>=<em><code>'cryst'</code></em>, <strong><code>order</code></strong>=<em><code>1</code></em>, <strong><code>cutoff</code></strong>=<em><code>10</code></em>, <strong><code>born</code></strong>=<em><code>None</code></em>, <strong><code>charge</code></strong>=<em><code>None</code></em>, <strong><code>k_list</code></strong>=<em><code>None</code></em>, <strong><code>fig_out</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_stats" class="doc_header"><code>plot_stats</code><a href="https://gitlab.com/jochym/hecss/tree/nbdev/hecss/monitor.py#L126" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_stats</code>(<strong><code>T</code></strong>=<em><code>300</code></em>, <strong><code>base_dir</code></strong>=<em><code>'phon'</code></em>, <strong><code>dfsetfn</code></strong>=<em><code>'DFSET'</code></em>, <strong><code>sqrN</code></strong>=<em><code>False</code></em>, <strong><code>show</code></strong>=<em><code>True</code></em>, <strong><code>plotchi2</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Plot monitoring histograms for the configuration list in confs.
If len(confs)&lt;3 this function is silent.</p>
<p>confs - configuration list
nat   - number of atoms in the structure
T     - target temperature in Kelvin
show  - call show() fuction at the end (default:True)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="monitor_stats" class="doc_header"><code>monitor_stats</code><a href="https://gitlab.com/jochym/hecss/tree/nbdev/hecss/monitor.py#L193" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>monitor_stats</code>(<strong><code>T</code></strong>=<em><code>300</code></em>, <strong><code>directory</code></strong>=<em><code>'phon'</code></em>, <strong><code>dfset</code></strong>=<em><code>'DFSET'</code></em>, <strong><code>plotchi2</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

